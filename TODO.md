# TODO — Patches & Features

> **Auto-updated**: The **Patches** section is regenerated by a pre-commit hook
> that scans for `TODO` comments and `NotImplementedError` stubs in the source.
> The **Features** section is curated manually (by human or AI assistant) to track
> planned modules and capabilities.

---

## Patches

Code-level TODOs and stubs that need attention in existing modules.

### Analysis

- **`load_movement_cycles()`** — Raises `NotImplementedError`. Load movement cycle data for a participant.
  [src/analysis/data_loader.py:67](src/analysis/data_loader.py#L67)

- **`load_all_participant_cycles()`** — Raises `NotImplementedError`. Load movement cycles from all participants in a project.
  [src/analysis/data_loader.py:94](src/analysis/data_loader.py#L94)

### Audio

- **`classify_cycle_artifacts_ml()`** — Raises `NotImplementedError`. Classify per-cycle artifacts using a trained ML model.
  [src/audio/cycle_qc.py:1184](src/audio/cycle_qc.py#L1184)

- **`validate_sync_quality_model_based()`** — Raises `NotImplementedError`. Validate sync quality using a trained model.
  [src/audio/cycle_qc.py:1388](src/audio/cycle_qc.py#L1388)

### Synchronization

- **`_build_cycle_metadata_context()`** — Query database directly for audio QC intervals
  [src/synchronization/quality_control.py:265](src/synchronization/quality_control.py#L265)

- **`_detect_stomp_by_rms_energy()`** — update this method to pick the FIRST peak exceeding a threshold. rather than the absolute maximum, to better capture initial foot contact
  [src/synchronization/sync.py:175-176](src/synchronization/sync.py#L175-L176)

---

## Features

Modules, sub-modules, and capabilities that are planned but not yet built.

### Study Configurations

- **`preOA` study config**
  Referenced in [src/studies/base.py](src/studies/base.py) and
  [src/studies/registry.py](src/studies/registry.py) but no
  `src/studies/preOA/` directory exists yet. Requires implementing the
  `StudyConfig` protocol for the preOA study (speed codes, sheet names,
  event names, column names, directory structure).

- **`SMoCK` study config**
  Also referenced in base protocol and registry. Requires a full
  `src/studies/smock/` implementation of `StudyConfig`.

### ML Pipeline

- **Maneuver-specific acoustic artifact classifier**
  Train an ML model to distinguish normal knee acoustic emissions (crepitus,
  cartilage friction) from external artifacts (talking, bumps, environmental
  noise). Will replace the statistical fallback in `cycle_qc.py`.

- **Model-based sync quality validation**
  Train a model that predicts expected acoustic patterns from joint-angle
  trajectories to validate synchronization quality. Will replace the
  rule-based fallback in `cycle_qc.py`.

### Analysis Layer (DB-backed)

- **DB-backed data loader for ML workflows**
  Rewrite `src/analysis/data_loader.py` functions to query PostgreSQL via
  `MovementCycleRecord` ORM, replacing the removed JSON-based approach.
  Unlocks `prepare_ml_dataset()` and downstream analysis scripts.

### Audio Processing

- **Phase B periodic-noise detection integration**
  Wire `detect_periodic_background_noise()` into the sync QC pipeline for
  per-cycle spectral analysis. The function exists but is currently orphaned.
